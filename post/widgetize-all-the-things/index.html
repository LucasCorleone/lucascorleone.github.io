<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <title>Widget-ize All The Things! | Tyler Benziger</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <link rel="shortcut icon" href="http://gravatar.com/avatar/9f5734a7063a4c48139f4999f3100167
?s=16">
  <link rel="stylesheet" href="/css/reset.css">
  <link rel="stylesheet" href="/css/mobile.css">
  <link rel="stylesheet" href="/css/desktop.css" media="(min-width:40em)">
  <link rel="stylesheet" href="/css/pygments.css">
  <link rel="stylesheet" href="/css/font.css">
  <script type="text/javascript" charset="utf-8" src="/js/matchmedia.js"></script>
  <script type="text/javascript" charset="utf-8" src="/js/picturefill.js"></script>
</head>

<body>
<div class="wrapper">
    <header>
    <div class="container">
        <div class="profile">
            <div class="social">
                <a href="http://twitter.com/tybenz">
                    <div data-picture data-alt="Twitter">
                        <div data-src="/img/twitter16.png"></div>
                        <div data-src="/img/twitter32.png"     data-media="(-webkit-min-device-pixel-ratio: 2)"></div>
                        <noscript><img src="/img/twitter16.png" alt="Twitter"></noscript>
                    </div>
                </a>
                <a href="http://github.com/tybenz">
                    <div data-picture data-alt="Github">
                        <div data-src="/img/octocat16.png"></div>
                        <div data-src="/img/octocat32.png"     data-media="(-webkit-min-device-pixel-ratio: 2)"></div>
                        <noscript><img src="/img/octocat16.png" alt="Github"></noscript>
                    </div>
                </a>
            </div>
            <img src="http://gravatar.com/avatar/9f5734a7063a4c48139f4999f3100167
?s=54" alt="avatar" class="avatar" />
        </div>
        <h5 class="logo"><a href="http://tybenz.com">Tyler Benziger</a></h5>
        <nav>
            <ul>
                
                    <li><a href="http://tybenz.com" class="active">Blog</a></li>
                
                
                <li><a href="http://tybenz.com/about">About</a></li>
                
                
                <li><a href="http://tybenz.com/projects">Projects</a></li>
                
            </ul>
        </nav>
        <div class="nav-slider">
            <div class="nav-selection blog"></div>
        </div>
    </div>
</header>

    
    <section id="main">
        <article class="container">
            <article class="post">
                <div class="post-header">
                    <p class="date">Jul 08, 2013</p>
                    <h1>Widget-ize All The Things!</h1>
                </div>
                <div class="post-body">
                    <p><strong>Reduce, reuse, refactor.</strong> That&#8217;s what we do as developers <em>all day</em>.
The <strong>reduce</strong> and <strong>refactor</strong> are obvious necessities, and admittedly some of the most fun and/or
most painful parts of the job. In my experience, the <strong>reuse</strong> goal is often the easiest to 
acheive. Yet, somehow, it is often the one most ignored, in the name of
&quot;iterative development&quot;. Trust me, nothing helps you iterate more
quickly than
writing things in a generic and reusable way the <em>first</em> time.</p>

<p>In my experience writing code to be purposefully reusable is fun,
challenging, and incredibly useful. I want to outline what writing
solid, reusable front-end web components should look like.</p>

<p>There are 3 different approaches when it comes to solving a UI problem or implementing a common UI pattern.</p>

<ol>
<li>Black box</li>
<li>Framework-based</li>
<li>The sweet spot</li>
</ol>

<h5 id="toc_4">Black box</h5>

<p>The black box approach is one that <em>every</em> web developer is familiar with.
What I&#8217;m referring to is a UI-based plugin that might solve a problem, but requires specific
markup structure,
or an entire 300 lines of code to accomplish something you could have done in 20. It&#8217;s a plugin you grab and throw
in your app/site and it&#8217;s supposed to just &quot;work&quot;. And it does for the most part. The convenience is tempting.</p>

<p>The problem comes when you want to customize/extend the thing to do a
little something extra. Most plugin authors don&#8217;t leave room for
interaction with the plugin itself. Sure, you got a slideshow widget by
downloading a couple of files, but what good is it if it&#8217;s not
fully customizable?</p>

<h5 id="toc_5">Enter the example</h5>

<p>The example I&#8217;ll be using throughout this post is what I call a toggle
widget. It&#8217;s like a dropdown but even simpler.
Click a button, a panel is shown. Click it again and it goes away.
Let&#8217;s take a look at the blackbox approach to this widget:</p>

<div class="highlight"><pre><code class="javascript"><span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">toggle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">options</span> <span class="p">)</span> <span class="p">{</span>

    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// caching objects</span>
        <span class="kd">var</span> <span class="nx">$this</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span> <span class="k">this</span> <span class="p">),</span>
            <span class="c1">// limited options</span>
            <span class="nx">settings</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
                <span class="nx">effect</span><span class="o">:</span> <span class="kc">undefined</span>
            <span class="p">},</span> <span class="nx">options</span> <span class="p">),</span>
            <span class="c1">// widget expectations</span>
            <span class="nx">id</span> <span class="o">=</span> <span class="nx">$this</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span> <span class="s1">&#39;href&#39;</span> <span class="p">),</span>
            <span class="nx">panel</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span> <span class="nx">id</span> <span class="p">);</span>

        <span class="c1">// widget logic</span>
        <span class="nx">$this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span> <span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">e</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
            <span class="k">if</span> <span class="p">(</span> <span class="nx">panel</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span> <span class="s1">&#39;display&#39;</span> <span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span> <span class="p">)</span> <span class="p">{</span>
                <span class="nx">panel</span><span class="p">.</span><span class="nx">show</span><span class="p">(</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">effect</span> <span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">panel</span><span class="p">.</span><span class="nx">hide</span><span class="p">(</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">effect</span> <span class="p">);</span>
            <span class="p">}</span>
        <span class="p">});</span>
    <span class="p">});</span>

<span class="p">};</span>

<span class="nx">$</span><span class="p">(</span> <span class="s1">&#39;.trigger&#39;</span> <span class="p">).</span><span class="nx">toggle</span><span class="p">();</span>
</code></pre></div>

<p>This is an example of a typical jQuery plugin*. It has few options,
expectations on markup structure, and very specific widget logic. Not
exactly ideal for integrating into a larger-scale application.</p>

<h5 id="toc_6">Framework-based</h5>

<p>Next up is the framework-based approach to writing components. I&#8217;m
personally a big fan of MVC in app development. But, when it comes to
writing UI components, there&#8217;s one thing I get annoyed with
often &mdash; if you do it the &quot;framework&quot; way, it&#8217;s less reusable by
definition.</p>

<p>Here&#8217;s an example:</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">ToggleView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span> <span class="s1">&#39;href&#39;</span> <span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$panel</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span> <span class="nx">id</span> <span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
        <span class="s1">&#39;click&#39;</span><span class="o">:</span> <span class="s1">&#39;togglePanel&#39;</span>
    <span class="p">},</span>
    
    <span class="nx">togglePanel</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">evt</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">evt</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>

        <span class="k">if</span> <span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">$panel</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span> <span class="s1">&#39;display&#39;</span> <span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$panel</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$panel</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">toggleView</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ToggleView</span><span class="p">({</span>
    <span class="nx">el</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span> <span class="s1">&#39;.trigger&#39;</span> <span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
    <span class="nx">panel</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span> <span class="s1">&#39;.panel&#39;</span> <span class="p">)</span>
<span class="p">});</span>
</code></pre></div>

<p>Notice that there are no options at all in this view. This is because
it&#8217;s custom-made for this application and we (ideally) know what our requirements are
while growing the codebase.</p>

<p>There&#8217;s an even bigger problem here, we&#8217;ve just rewritten a common UI
widget in a very specific &quot;Backbone-y&quot; way. All reusability is gone
(outside of another Backbone project that is). Converting
this code into a more flexible widget will take time and effort.</p>

<h5 id="toc_7">The Sweet Spot</h5>

<p>That&#8217;s where option #3 comes in. The compromise between isolated,
they-just-work plugins and event-driven MVC-friendly components. A solid
reusable widget should have the following criteria:</p>

<ol>
<li>Options (and defaults)</li>
<li>DOM event bindings</li>
<li>Widget Logic</li>
<li>External events</li>
</ol>

<p>Let&#8217;s take a look at some code:</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">Toggle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">el</span><span class="p">,</span> <span class="nx">options</span> <span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">widget</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

    <span class="c1">// override defaults with options passed in</span>
    <span class="nx">options</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">defaultOptions</span><span class="p">,</span> <span class="nx">options</span> <span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span> <span class="nx">el</span> <span class="p">);</span>
    <span class="c1">// selector for our trigger is an option</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$trigger</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span> <span class="nx">options</span><span class="p">.</span><span class="nx">triggerSelector</span> <span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span><span class="p">;</span>

    <span class="c1">// eventName is an option and the event itself</span>
    <span class="c1">// calls a method that can be overridden</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$trigger</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span> <span class="nx">options</span><span class="p">.</span><span class="nx">eventName</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">evt</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">widget</span><span class="p">.</span><span class="nx">_handleEvent</span><span class="p">(</span> <span class="nx">evt</span> <span class="p">);</span>
    <span class="p">});</span>
<span class="p">};</span>

<span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span> <span class="nx">Toggle</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">defaultOptions</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">triggerSelector</span><span class="o">:</span> <span class="s1">&#39;.trigger&#39;</span><span class="p">,</span>
        <span class="nx">eventName</span><span class="o">:</span> <span class="s1">&#39;click&#39;</span><span class="p">,</span>
        <span class="nx">preventDefault</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nx">showClassName</span><span class="o">:</span> <span class="s1">&#39;show&#39;</span><span class="p">,</span>
        <span class="nx">hideClassName</span><span class="o">:</span> <span class="s1">&#39;hide&#39;</span>
    <span class="p">},</span>

    <span class="nx">_handleEvent</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">evt</span> <span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">opts</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">,</span>
            <span class="nx">$el</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">,</span>
            <span class="nx">$target</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">target</span> <span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">preventDefault</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nx">evt</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span> <span class="s1">&#39;before-toggle&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">panel</span><span class="o">:</span> <span class="nx">$el</span><span class="p">,</span> <span class="nx">trigger</span><span class="o">:</span> <span class="nx">$target</span> <span class="p">}</span> <span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span> <span class="nx">$el</span><span class="p">.</span><span class="nx">hasClass</span><span class="p">(</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">showClassName</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span> <span class="s1">&#39;before-toggle-hide&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">panel</span><span class="o">:</span> <span class="nx">$el</span><span class="p">,</span> <span class="nx">trigger</span><span class="o">:</span> <span class="nx">$target</span> <span class="p">}</span> <span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
            <span class="c1">// Events triggered...</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span> <span class="s1">&#39;toggle-hide&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">panel</span><span class="o">:</span> <span class="nx">$el</span><span class="p">,</span> <span class="nx">trigger</span><span class="o">:</span> <span class="nx">$target</span> <span class="p">}</span> <span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span> <span class="s1">&#39;before-toggle-show&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">panel</span><span class="o">:</span> <span class="nx">$el</span><span class="p">,</span> <span class="nx">trigger</span><span class="o">:</span> <span class="nx">$target</span> <span class="p">}</span> <span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
            <span class="c1">// ... when important things happen</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span> <span class="s1">&#39;toggle-show&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">panel</span><span class="o">:</span> <span class="nx">$el</span><span class="p">,</span> <span class="nx">trigger</span><span class="o">:</span> <span class="nx">$target</span> <span class="p">}</span> <span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// Save last clicked trigger</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">lastClicked</span> <span class="o">=</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">target</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="c1">// No longer hide and show but rather just applying/removing</span>
    <span class="c1">// classes</span>
    <span class="nx">hide</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">showClassName</span> <span class="p">).</span><span class="nx">addClass</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">hideClassName</span> <span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">show</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">hideClassName</span> <span class="p">).</span><span class="nx">addClass</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">showClassName</span> <span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">trigger</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">evt</span><span class="p">,</span> <span class="nx">data</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span> <span class="k">this</span> <span class="p">).</span><span class="nx">trigger</span><span class="p">(</span> <span class="nx">evt</span><span class="p">,</span> <span class="nx">data</span> <span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">on</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">evt</span><span class="p">,</span> <span class="nx">fn</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span> <span class="k">this</span> <span class="p">).</span><span class="nx">on</span><span class="p">(</span> <span class="nx">evt</span><span class="p">,</span> <span class="nx">fn</span> <span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">toggle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">options</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">widget</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Toggle</span><span class="p">(</span> <span class="k">this</span><span class="p">,</span> <span class="nx">options</span> <span class="p">);</span>
    <span class="p">});</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">toggle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Toggle</span><span class="p">(</span> <span class="s1">&#39;.panel&#39;</span> <span class="p">);</span> <span class="c1">// or $( &#39;.panel&#39; ).toggle();</span>
</code></pre></div>

<p>Here have a component that is customizable with options, that does its
job as it&#8217;s supposed to and that provides ways for other pieces of an
application to hook into and modify its behavior.</p>

<p>Admittedly, this implementation is much longer, but that&#8217;s the price of
writing something that will work anywhere</p>

<h5 id="toc_8">Dropdown</h5>

<p>Let&#8217;s take our example even further. Now, we want an actual dropdown.
That is, we want to use our little
toggle widget but change the contents of the panel to reflect what ever
items are supposed to be in the dropdown. And we want our widget to be
smart enough that multiple toggles can control the same dropdown and have
different markup depending on which toggle was clicked.</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">Dropdown</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">ele</span><span class="p">,</span> <span class="nx">templateFn</span><span class="p">,</span> <span class="nx">options</span> <span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">widget</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
        <span class="nx">toggle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Toggle</span><span class="p">(</span> <span class="nx">ele</span> <span class="p">);</span>

    <span class="c1">// Need options for the dropdown widget itself</span>
    <span class="nx">options</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span> <span class="p">{},</span> <span class="k">this</span><span class="p">.</span><span class="nx">defaultOptions</span><span class="p">,</span> <span class="nx">options</span> <span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span><span class="p">;</span>

    <span class="nx">toggle</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span> <span class="s1">&#39;before-toggle&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">evt</span><span class="p">,</span> <span class="nx">data</span> <span class="p">)</span> <span class="p">{</span>
        <span class="c1">// The toggle widget saves the last trigger used</span>
        <span class="c1">// If the trigger that was clicked is different than this one</span>
        <span class="c1">// we hide the panel to override the default toggle behavior</span>
        <span class="k">if</span> <span class="p">(</span> <span class="nx">data</span><span class="p">.</span><span class="nx">trigger</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="nx">toggle</span><span class="p">.</span><span class="nx">lastClicked</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nx">toggle</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="kd">var</span> <span class="nx">panel</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">panel</span><span class="p">,</span>
            <span class="nx">trigger</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">trigger</span><span class="p">,</span>
            <span class="nx">templateData</span> <span class="o">=</span> <span class="nx">trigger</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span> <span class="nx">options</span><span class="p">.</span><span class="nx">dataAttr</span> <span class="p">);</span>

        <span class="c1">// Please for the love of all things good, use a templating engine</span>
        <span class="nx">panel</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span> <span class="nx">templateFn</span><span class="p">(</span> <span class="nx">templateData</span> <span class="p">)</span> <span class="p">).</span><span class="nx">addClass</span><span class="p">(</span> <span class="nx">options</span><span class="p">.</span><span class="nx">dropdownClassName</span> <span class="p">);</span>

        <span class="c1">// Small (resuable) utility to position elements relative to others</span>
        <span class="kd">var</span> <span class="nx">pos</span> <span class="o">=</span> <span class="nx">positionElementAroundAnother</span><span class="p">(</span> <span class="nx">trigger</span><span class="p">,</span> <span class="nx">panel</span><span class="p">,</span> <span class="p">{</span>
            <span class="nx">align</span><span class="o">:</span> <span class="s1">&#39;right&#39;</span><span class="p">,</span>
            <span class="nx">alignOffset</span><span class="o">:</span> <span class="mi">10</span><span class="p">,</span>
            <span class="nx">position</span><span class="o">:</span> <span class="s1">&#39;below&#39;</span><span class="p">,</span>
            <span class="nx">positionOffset</span><span class="o">:</span> <span class="mi">40</span>
        <span class="p">});</span>

        <span class="nx">panel</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span>
            <span class="s1">&#39;top&#39;</span><span class="o">:</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="s1">&#39;px&#39;</span><span class="p">,</span>
            <span class="s1">&#39;left&#39;</span><span class="o">:</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="s1">&#39;px&#39;</span>
        <span class="p">});</span>
    <span class="p">});</span>
    
    <span class="nx">toggle</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span> <span class="s1">&#39;toggle-show&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">evt</span><span class="p">,</span> <span class="nx">data</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">widget</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span> <span class="s1">&#39;dropdown-show&#39;</span><span class="p">,</span> <span class="nx">data</span> <span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">toggle</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span> <span class="s1">&#39;toggle-hide&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">evt</span><span class="p">,</span> <span class="nx">data</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">widget</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span> <span class="s1">&#39;dropdown-hide&#39;</span><span class="p">,</span> <span class="nx">data</span> <span class="p">);</span>
    <span class="p">});</span>
<span class="p">};</span>

<span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span> <span class="nx">Dropdown</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">defaultOptions</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">dropdownClassName</span><span class="o">:</span> <span class="s1">&#39;dropdown&#39;</span><span class="p">,</span>
        <span class="nx">dataAttr</span><span class="o">:</span> <span class="s1">&#39;dropdown-list&#39;</span>
    <span class="p">},</span>
    
    <span class="nx">trigger</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">evt</span><span class="p">,</span> <span class="nx">data</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span> <span class="k">this</span> <span class="p">).</span><span class="nx">trigger</span><span class="p">(</span> <span class="nx">evt</span><span class="p">,</span> <span class="nx">data</span> <span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">on</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">evt</span><span class="p">,</span> <span class="nx">fn</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span> <span class="k">this</span> <span class="p">).</span><span class="nx">on</span><span class="p">(</span> <span class="nx">evt</span><span class="p">,</span> <span class="nx">fn</span> <span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="c1">// Setting up dropdown object for each trigger</span>
<span class="nx">$</span><span class="p">(</span> <span class="s1">&#39;.trigger&#39;</span> <span class="p">).</span><span class="nx">each</span><span class="p">(</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">$this</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span> <span class="k">this</span> <span class="p">),</span>
        <span class="nx">list</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span> <span class="nx">$this</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span> <span class="s1">&#39;items&#39;</span> <span class="p">).</span><span class="nx">split</span><span class="p">(</span> <span class="s1">&#39;,&#39;</span> <span class="p">),</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">item</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="nx">link</span><span class="o">:</span> <span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="nx">item</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span> <span class="sr">/\s/g</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span> <span class="p">),</span>
                <span class="nx">text</span><span class="o">:</span> <span class="nx">item</span>
            <span class="p">};</span>
        <span class="p">});</span>

    <span class="c1">// Set our template object for the dropdown</span>
    <span class="c1">// on a data attribute</span>
    <span class="nx">$this</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">list</span><span class="o">:</span> <span class="nx">list</span> <span class="p">}</span> <span class="p">);</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">dd</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Dropdown</span><span class="p">(</span> <span class="s1">&#39;.panel&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">data</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span> <span class="nx">$</span><span class="p">(</span> <span class="s1">&#39;#dd-menu-template&#39;</span> <span class="p">).</span><span class="nx">text</span><span class="p">(),</span> <span class="nx">data</span> <span class="p">);</span>
<span class="p">},</span> <span class="p">{</span> <span class="nx">dataAttr</span><span class="o">:</span> <span class="s1">&#39;list&#39;</span> <span class="p">}</span> <span class="p">);</span>
</code></pre></div>

<p>Live demo <a href="http://codepen.io/tybenz/pen/BIvAo">here</a>.</p>

<p>Notice that the toggle widget does it&#8217;s normal thing. It&#8217;s really good
at keeping track of whether or not the panel is showing, but it also
fires events when a hide or show occurs. This let&#8217;s write
another component &quot;Dropdown&quot; that listens for the before show event and tweaks the
markup of the panel to what we need.</p>

<p>Slick huh? Now you&#8217;ve got a widget that can handle a simple UI pattern,
and it&#8217;s customizable/extensible enough to do something <em>really</em> useful.</p>

<p>Not to mention the more-complex dropdown widget follows the same
principles. It provides options, as well as events for when
things are hidden/shown.</p>

<p>It&#8217;s also flexible in other respects.
The markup generation for the dropdown is left outside of the widget. That
should be left up to the developer to do as they please. In this case, I&#8217;m using
data attributes and a templating engine to generate the markup.</p>

<h5 id="toc_9">Wrap up</h5>

<p>In my experience amassing an arsenal of these small pattern-based
reusable bits of code can really make working on any application so much
easier. Give it a try and you&#8217;ll find that building out a library of
these types of components is extremely rewarding and in general, it will
make you a better developer.</p>

<p>I&#8217;ve tried to lay out what I think is a template for simple, but
powerful components so that you can go forth and widgetize all of your UI.
As always feel free to submit any comments/questions on
<a href="http://twitter.com/tybenz">Twitter</a>.</p>

                </div>
            </article>
        </article>
    </section>
    
    <footer>
    <nav class="container">
        <ul>
            <li>&copy; Tyler Benziger 2013</li>
        </ul>
    </nav>
</footer>

</div>
</body>
<script type="text/javascript">

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-33073396-1']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

</script>
<script type="text/javascript" charset="utf-8">
    document.onreadystatechange = function() {
        if ( document.readyState == 'complete' ) {
            var active = document.querySelector( 'header a.active' ).innerHTML.toLowerCase(),
                links = document.querySelectorAll( 'header nav li a'),
                selection = document.querySelector( 'header .nav-selection' ),
                i, link;
            for ( i = 0; i < links.length; i++ ) {
                link = links[ i ];
                console.log(link);
                link.addEventListener( 'mouseover', function() {
                    selection.className = 'nav-selection';
                    selection.className = 'nav-selection ' + this.innerHTML.toLowerCase();
                });
                link.addEventListener( 'mouseout', function() {
                    selection.className = 'nav-selection ' + active;
                });
            }
        }
    };
</script>

</html>

